<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CRUD</title>
    <style>
        #container{
      margin-left: 15%;
        margin-right: 15%;
        }
        a{color:#FA6FEC;}

        h2{ color:rgb(253, 212, 90);}

        h3,h4{
        color:rgb(152, 198, 241);}

        code{
        color:#D7FF92;}



    </style>

</head>

<body style="background-color:rgb(26, 26, 26);color:white;">

<div id="container">
    <h1 align="center" id="api-rest-de-crud" style="color:rgb(253, 212, 90);">API Rest de CRUD</h1>
    <p align="center">
        <img src="https://img.shields.io/badge/Java-ED8B00?style=for-the-badge&logo=java&logoColor=white"/>
        <img src="https://img.shields.io/badge/Spring-6DB33F?style=for-the-badge&logo=spring&logoColor=white"/>
        <img src="https://img.shields.io/badge/PostgreSQL-316192?style=for-the-badge&logo=postgresql&logoColor=white"/>
        <img src="https://img.shields.io/badge/Google_Cloud-4285F4?style=for-the-badge&logo=google-cloud&logoColor=white"><br>
        <img src="http://img.shields.io/static/v1?label=STATUS&message=EM%20DESENVOLVIMENTO&color=RED&style=for-the-badge"/>
    </p>

    <h2 id="o-desafio" style="color:rgb(253, 212, 90)">O Desafio</h2>

    <p>O desafio da aplica√ß√£o pode ser visualizado completo em: <a
            href="https://github.com/aikodigital/teste-backend-estagio-v3">https://github.com/aikodigital/teste-backend-estagio-v3</a>
    </p>

    <p>Voc√™ √© o desenvolvedor backend de uma empresa que coleta dados de equipamentos utilizados em uma opera√ß√£o
        florestal. Dentre esses dados est√£o o hist√≥rico de posi√ß√µes e estados desses equipamentos. O estado de um
        equipamento √© utilizado para saber o que o equipamento estava fazendo em um determinado momento, seja Operando,
        Parado ou em Manuten√ß√£o. O estado √© alterado de acordo com o uso do equipamento na opera√ß√£o, j√° a posi√ß√£o do
        equipamento √© coletada atrav√©s do GPS e √© enviada e armazenada de tempo em tempo pela aplica√ß√£o.<br>
        Seu objetivo √©, de posse desses dados, desenvolver uma aplica√ß√£o backend que exponha esses dados atrav√©s de uma
        API.</p>
    <h2 id="resumo-da-aplica√ß√£o">Resumo da aplica√ß√£o</h2>
    <p>Desenvolvimento de uma API de CRUD utilizando Java + SpringBoot, al√©m do banco de dados PostgreSQL, com
        documenta√ß√£o da API realizada no Swagger.</p>
    <h2 id="vis√£o-geral">Vis√£o Geral</h2>
    <h3 id="üë®üíª-status-da-aplica√ß√£o">üë®‚Äçüíª Status da aplica√ß√£o</h3>
    <p> ‚úÖ Documenta√ß√£o da API<br>
        ‚úÖ Documenta√ß√£o da Aplica√ß√£o <br>
        ‚úÖ API do CRUD <br>
        ‚úÖ P√°gina Hist√≥rico de estados <br>
        ‚úÖ Conteineriza√ß√£o <br>
        ‚úÖ Mapa de Equipamentos <br>
        ‚úÖ Testes <br></p>
    <h3 id="üìã-pr√©-requisitos">üìã Pr√©-requisitos</h3>
    <ul>
        <li>Java <br></li>
        <li>Docker<br></li>
    </ul>
    <h3 id="üõ†Ô∏è-ferramentas-utilizadas">üõ†Ô∏è Ferramentas utilizadas</h3>
    <ul>
        <li><a href="https://spring.io/">SpringBoot</a> - O framework web utilizado</li>
        <li><a href="https://developers.google.com/maps/documentation/javascript?hl=pt-br">Google Maps API
            JavaScript</a> - Utilizado para mostrar a localiza√ß√£o dos equipamentos no mapa,
            sendo um mapa interativo.
        </li>
        <li><a href="https://www.docker.com/">Docker</a> - Utilizado para build, teste e deploy da aplica√ß√£o</li>
        <li><a href="https://swagger.io/tools/swagger-ui/">SwaggerUI</a> - Interface utilizada para documenta√ß√£o da API
        </li>
        <li><a href="https://maven.apache.org/">Maven</a> - Gerente de Depend√™ncia</li>
    </ul>
    <h3 id="üíª-por-dentro-da-aplica√ß√£o">üíª Por dentro da aplica√ß√£o</h3>
    <img src="https://raw.githubusercontent.com/aikodigital/teste-backend-estagio-v3/master/img/diagram.png"
         style="width:100%;"/>


    <p>O primeiro passo √© compreendermos a <a
            href="https://www.visual-paradigm.com/guide/uml-unified-modeling-language/what-is-uml/">UML</a>, podemos
        interpretar que, os diamantes negros indicam uma rela√ß√£o de <a
                href="https://stackoverflow.com/questions/885937/what-is-the-difference-between-association-aggregation-and-composition">composi√ß√£o</a>,
        sendo a parte &quot;owner&quot; da rela√ß√£o, enquanto os c√≠rculos cinzas, s√£o as partes &quot;owned&quot;.</p>
    <p>Ap√≥s compreendido o <a
            href="https://docs.oracle.com/cd/A97688_16/generic.903/a97677/ormap.htm">relacionamento</a>, √© necess√°rio
        definir como ser√° organizado os componentes das entidades.
        <br><br></p>
    <p><strong>As entidades foram subdivididas em 5 partes:</strong><br>
        Por padr√£o, para facilitar a manuten√ß√£o do c√≥digo, as entidades s√£o divididas entre:
        <br><br></p>
    <ul>
        <li><p><a href="https://pt.wikipedia.org/wiki/Plain_Old_Java_Objects">Model</a>
            <br>Popularmente conhecido como Java Bean, Na arquitetura MVC, representa o dom√≠nio da entidade<code>(@Entity)</code>,
            √© uma classe em Java onde conter√° todos os atributos presentes da entidade(constructors, getters, setters,
            etc). √â a classe a ser <a
                    href="https://www.javatpoint.com/serialization-in-java#:~:text=Serializable%20is%20a%20marker%20interface,object%20needs%20to%20be%20persisted">serializada</a>.
        </p>
            <br>
        </li>
        <li><p><a href="https://en.wikipedia.org/wiki/Data_transfer_object">DTO</a>
            <br>√â a classe que ser√° utilizada para a transfer√™ncia de dados do objeto referente a entidade. Neste
            exemplo, nas classes &quot;owner&quot;, suas ID&#39;s s√£o criadas autom√°ticamente por um gerador UUID.
            Supondo a classe &#39;EquipmentModel&#39;, ela possui os atributos {id, name}, como o id √© gerado
            automaticamente, n√£o faz sentido passarmos para o usu√°rio uma cria√ß√£o de novo objeto EquipmentModel tendo
            que preencher os valores de id e name, portanto, √© criado uma classe EquipmentModelDTO, apenas como
            par√¢metro o atributo &#39;name&#39;, se tornando uma classe &#39;facilitadora&#39;.</p>
            <br>
        </li>
        <li><p><a href="https://docs.spring.io/spring-data/jpa/docs/1.5.0.RELEASE/reference/html/jpa.repositories.html">Repository</a>
            <br>√â a classe que implementa o JPA Repository(Java Persistence API), sendo um mecanismo para encapsular o
            banco, recuperar e buscar comportamento que simulam uma cole√ß√£o de objetos, basicamente √© a parte em que faz
            a intermedia√ß√£o dos dados da entidade e o banco de dados.</p>
            <br>
        </li>
        <li><p><a href="https://www.educba.com/spring-boot-service/">Service</a>
            <br>√â respons√°vel pela l√≥gica de neg√≥cio da sua aplica√ß√£o, al√©m de ser respons√°vel por se comunicar com as
            camadas mais internas do Software, como por exemplo, uma camada de dados, podemos dizer que √© o complemento
            da classe Repository, nela decidimos o tipo de retorno dos m√©todos, a implementa√ß√£o dos m√©todos, tudo
            referente a conex√£o entre as entidades e o banco de dados.</p>
            <br>
        </li>
        <li><p><a
                href="https://education.launchcode.org/java-web-development/chapters/spring-controllers-and-routes/controllers-simple.html">Controller</a>
            <br>O controller tamb√©m √© uma das classes que fazem parte das arquiteturas MVC, sendo respons√°vel pelo
            processamento das requisi√ß√µes e das respostas. Podemos dizer que √© a classe em que faz a conex√£o do usu√°rio
            real e o programa desenvolvido por tr√°s, realizando o controle das p√°ginas.</p>
            <br></li>
    </ul>
    <h2 id="üîß-quest√µes-t√©cnicas">üîß Quest√µes t√©cnicas</h2>
    <p>Vamos explorar as decis√µes t√©cnicas que foram fundamentais para a modelagem do projeto:</p>
    <p>A primeira e crucial decis√£o foi a escolha das ferramentas que utilizaremos. Optei por Java como linguagem de
        programa√ß√£o devido √† sua ampla ado√ß√£o e suporte robusto na comunidade de desenvolvedores. Para construir a API
        de CRUD necess√°ria, optei pelo framework SpringBoot. Ele atua como uma &quot;cola invis√≠vel&quot; para o Java,
        unindo-se harmoniosamente a componentes essenciais, como o Hibernate e o EntityManager. Essa combina√ß√£o
        permitir√° trabalhar de forma eficiente e eficaz nos bastidores do projeto.</p>
    <p>O SpringBoot oferece uma experi√™ncia de desenvolvimento aprimorada, atrav√©s do uso de suas anota√ß√µes intuitivas,
        teremos uma base s√≥lida para iniciar o projeto. Al√©m disso, o Hibernate, uma ferramenta de mapeamento
        objeto-relacional, simplifica a intera√ß√£o com o banco de dados, permitindo que concentremos nossos esfor√ßos no
        desenvolvimento de recursos e na manipula√ß√£o de objetos Java em vez de escrever consultas SQL detalhadas.</p>
    <h3 id="componentes-da-entidade">Componentes da entidade</h3>
    <p> Por uma quest√£o de padr√£o de arquitetura de Software, as entidades foram sub-dividas em 5 componentes:<br>
        Model (<code>@Entity</code>), DTO, Repository (<code>@Repository</code>), Service (<code>@Service</code>) e
        Controller (<code>@Controller</code>), aumentando a <a
                href="https://pt.stackoverflow.com/questions/81314/o-que-s%C3%A3o-os-conceitos-de-coes%C3%A3o-e-acoplamento">coes√£o
            do c√≥digo</a> se tornando mais simples para a corre√ß√£o de eventuais problemas.</p>
    <h4 id="anota√ß√µes-importantes">Anota√ß√µes importantes:</h4>
    <p>Possuem muitas anota√ß√µes essenciais utilizadas, ent√£o por serem anota√ß√µes &quot;autoexplicativas&quot;, n√£o as
        considerarei, explicarei apenas aquelas que possuem uma objetifica√ß√£o mais espec√≠fica.</p>
    <p><code>@EmbeddedId</code> - Algumas entidades n√£o possuem um √∫nico ID pr√≥prio, possuem ID&#39;s prim√°rias,
        conhecidas como <a href="https://www.baeldung.com/jpa-composite-primary-keys">CompositeKey</a>, pode ser
        implementada atrav√©s de outros m√©todos, como o @IdClass, entretanto, acredito que seja uma forma mais expl√≠cita
        de manipular e entender os ID&#39;s que comp√µem a entidade. <br></p>
    <p><code>@JsonIgnore</code> - Alguns atributos, n√£o necessito que sejam serializados, ou melhor dizendo, n√£o quero
        que fa√ßa a transf√™rencia dos dados em espec√≠ficos momentos do c√≥digo, portanto, aviso ao Hibernate que este
        atributo espec√≠fico n√£o necessita transferir os dados. <br>
        <br>
        Ex:</p>
    <pre><code>  @JsonIgnore
    public EquipmentPositionHistoryPK getEquipmentPositionHistoryPK() {
        return equipmentPositionHistoryPK;
    }  
</code></pre>
    <p>Ao fazer isto, digo ao Hibernate para n√£o se preocupar em retornar um objeto do
        tipo EquipmentPositionHistory, no momento da gera√ß√£o do arquivo padr√£o <a
                href="https://www.json.org/json-en.html">JSON</a>
        <br></p>
    <p><code>@Transactional</code> - √â utilizado para garantir que, antes de realizar uma transa√ß√£o de dados, √© gerado
        um &quot;backup&quot; dos dados persistidos, tratando todas a√ß√µes referentes ao dado persistido seja uma
        transa√ß√£o √∫nica, em que, se algo der errado durante essa transa√ß√£o de dados, por exemplo uma falha, a anota√ß√£o
        @Transactional, realizar√° um rollback dos dados, cooperando na integridade dos dados, geralmente est√° anota√ß√£o √©
        utilizada em a√ß√µes do tipo salvar, editar, deletar.
        <br>
        <br>
        <code>@NotNull e @NotBlank</code> - Utilizado para designar que o valor do atributo n√£o pode ser nulo/vazio.</p>
    <h4 id="atributos-das-anota√ß√µes-das-entidades">Atributos das anota√ß√µes das entidades</h4>
    <p><code>fetch = FetchType.LAZY</code> - √â o tipo de busca de dados padr√£o das anota√ß√µes, a diferen√ßa entre
        fetchType.EAGER e fetchType.LAZY, √© que na anota√ß√£o LAZY, ele apenas busca os dados da aplica√ß√£o no momento que
        os dados forem utilizados, evitando carregar todos os dados durante a inicia√ß√£o da aplica√ß√£o.
        <br>
        <br></p>
    <p><code>mappedBy</code> - Informa por qual nome de atributo a entidade est√° sendo mapeada.
        <br></p>
    <p><code>cascade = CascadeType.ALL</code> - √â o tipo das <a href="https://www.baeldung.com/jpa-cascade-types">propaga√ß√µes</a>
        que uma a√ß√£o na entidade ocorrer√°.
        <br></p>
    <p><code>orphanRemoval = true</code> - Uma anota√ß√£o que basicamente diz que, caso Equipment seja filho de
        EquipmentModel, se EquipmentModel for exclu√≠do do banco de dados, seus filhos ser√£o exclu√≠dos tamb√©m.
        <br></p>
    <p>Ex:</p>
    <pre><code>public class EquipmentModel {
@OneToMany(mappedBy = &quot;equipmentModel&quot;, cascade = CascadeType.ALL,orphanRemoval = true)
    private List&lt;Equipment&gt; equipments;
} 
</code></pre>
    <br>

    <p>Caso EquipmentModel seja exclu√≠do, est√° exclus√£o se propagar√° para toda lista de Equipments referentes ao
        EquipmentModel.</p>
    <h3 id="cria√ß√£o-das-p√°ginas-web">Cria√ß√£o das p√°ginas WEB</h3>
    <p>Por padr√£o do Spring MVC, as p√°ginas HTML s√£o armazenadas em <code>src/main/resources/templates</code>. Como o
        projeto n√£o √© focado no frontend, s√£o p√°ginas simples.
        <br>
        Para organizar o mapeamento das nossas p√°ginas, precisamos de uma classe <code>@Controller</code>, que est√°
        localizada em <code>src/main/java/apirest/aiko/WebPages/MainController.java</code>. Esta classe √© usada para
        mapear nossas p√°ginas HTML e, se necess√°rio, passar dados do <em>backend</em> para o <em>frontend</em>,
        utilizando o <em>Thymeleaf</em> para a persist√™ncia destes dados.</p>
    <p>Em nossa p√°gina &quot;home&quot;, para criarmos bot√µes que carregam outras p√°ginas, necessitamos utilizar um
        script do JQuery:</p>
    <pre><code>    &lt;script src=&quot;https://code.jquery.com/jquery-3.6.0.min.js&quot;&gt;&lt;/script&gt;
    &lt;script&gt;
               function carregarPagina(pagina) {
               $(&quot;.middle&quot;).load(pagina);
        }
    &lt;/script&gt;
</code></pre>
    <p>Neste script, carregamos uma nova p√°gina html mapeada em nosso <code>@Controller</code>, e a carregamos essa
        p√°gina em nossa div <code>middle</code>.</p>
    <h3 id="implementa√ß√£o-da-api-do-google-maps">Implementa√ß√£o da API do Google Maps</h3>
    <p>Para compreender a API do Google Maps, sugiro a leitura da <a
            href="https://developers.google.com/maps/documentation/javascript/overview?hl=pt-br">documenta√ß√£o</a>
        dispon√≠vel pelo Google. </p>
    <p>Para realizar a implementa√ß√£o da API, que √© dada em JavaScript, em nossa aplica√ß√£o Java, podemos utilizar a
        anota√ß√£o <code>&lt;script th:inline=&quot;javascript&quot;&gt;</code> de nosso <em>Thymeleaf</em>, </p>
    <h3 id="dockerizando-a-aplica√ß√£o">Dockerizando a aplica√ß√£o</h3>
    <p>A conteiniriza√ß√£o do aplicativo √© algo bem simples de configurar, na pasta ra√≠z do projeto, possu√≠mos <code>Dockerfile</code>
        e <code>docker-compose.yml</code>, que armazenam as configura√ß√µes de nosso container.<br> Resumidamente, nesta
        aplica√ß√£o criaremos um container para armazenar o SpringBoot(container: jamilzin1APP), configurando o arquivo
        <code>Dockerfile</code> para executar nosso arquivo .jar dentro do container.<br>
        E outro container, para armazenar o banco de dados postgres(container: dbAPP), no arquivo <code>docker-compose.yml</code>
        sua configura√ß√£o √© bem simples, apenas destaco a linha que definimos &quot;volumes&quot; que mapeamos a pasta
        &quot;postgres-data&quot; para persistir os dados, preservando-os mesmo ap√≥s as reinicia√ß√µes do container,
        facilitando tamb√©m para um poss√≠vel backup.</p>
    <h2 id="‚öôÔ∏è-como-configurar-para-teste-da-aplica√ß√£o">‚öôÔ∏è Como configurar para teste da aplica√ß√£o</h2>
    <ol>
        <li>Clone this repo: <code>git clone https://github.com/jamilzin1/API_Rest_de_CRUD_SpringBoot.git</code>
        <li> Abra o terminal no diret√≥rio do arquivo.</li>
        <li>Execute o docker: <code>docker-compose up</code></li>
        <li>Restaure o banco de dados da aplica√ß√£o. Execute o terminal para a pasta onde est√° salvo o reposit√≥rio e
            use
        </li>
        <p><code>docker exec -i dbAPP pg_restore -U postgres -d jamilzin1_db_apirest_test &lt; data.sql</code>
        <li> Acesse <a href="http://localhost:8080/main">http://localhost:8080/main</a></li>
    </ol>

    <br></p>
    <p><strong>Fim!</strong></p>
    <p>Voc√™ est√° pronto para desfrutar da aplica√ß√£o :) </p>
    <h2 id="‚ñ∂Ô∏è-testes-da-aplica√ß√£o">‚ñ∂Ô∏è Testes da aplica√ß√£o</h2>
    <p>// Teste parcial, ainda irei realizar algumas mudan√ßas, como adi√ß√£o de filtros na posi√ß√£o dos equipamentos no
        mapa.</p>
</div>
</body>
</html>

